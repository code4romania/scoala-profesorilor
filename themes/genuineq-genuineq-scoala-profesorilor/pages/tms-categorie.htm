title = "TMS - Categorie"
url = "/tms-categorie/:slug/:page?"
layout = "tms-non-static"
is_hidden = 0

[builderList categoriesList]
modelClass = "Genuineq\Tms\Models\Category"
scope = "-"
scopeValue = "{{ :scope }}"
displayColumn = "name"
noRecordsMessage = "Nu exista inregistrari"
detailsPage = "tms-categorie"
detailsKeyColumn = "slug"
detailsUrlParameter = "slug"
recordsPerPage = 8
pageNumber = "{{ :page }}"

[session]
security = "all"
allowedUserGroups[] = "teacher"
allowedUserGroups[] = "school"
==
<?php
    use Genuineq\Tms\Models\Category;
    use Genuineq\Tms\Models\Course;

    function prepareVars(){
        /* Get the search/filter options */
        $options = post();

        $this['courses'] = Category::whereSlug($this->param('slug'))->first()->filterCourses($options);
        $this['pages'] = $this['courses']->lastPage();
        $this['page'] = $this['courses']->currentPage();
    }

    function onCourseSearch() {
        $this->prepareVars();
    }

    function onStart()
    {
        /* Assets for carousel-half-page partial. */
        $this->addCss('assets/css/carousel-half-page.css');

        $this['accreditations'] = Course::getFilterAccreditations();
        $this['sortTypes'] = Course::getSortingTypes();

        $this->prepareVars();
    }
?>
==
<!--Intro Section-->
{% partial "carousel-half-page" %}
<!--/.Intro Section-->

<div class="container py-5">
    <div class="row">
        <div class="col-sm-12">

            {% partial "course-search-form" %}

            <!--Courses Section-->
            <h5 class="mb-3 font-weight-bold">{{ 'category.courses.title'|_ }}</h5>

            <div id="courseSearchResults">
                {% partial "course-grid" %}
            </div>
            <div id="courseSearchPagination">
                {% partial "course-search-pagination" %}
            </div>
            <!--/.Courses Section-->

            <!--Separator-->
            <hr class="my-5 bg-dark">
            <!--/.Separator-->

            <!--Categories Section-->
            <h5 class="mb-3 font-weight-bold">{{ 'category.categories.title'|_ }}</h5>

            {% partial "category-grid"
                categories=categoriesList.records
                detailsPage=categoriesList.detailsPage
                detailsKeyColumn=categoriesList.detailsKeyColumn
                detailsUrlParameter=categoriesList.detailsUrlParameter
                pagination=false
                rawPagination=false
            %}
            <!--/.Categories Section-->

        </div>
    </div>
</div>
